# Requirements Archive: v1.0 Prompt Template Resources

**Archived:** 2026-01-20
**Status:** SHIPPED

This is the archived requirements specification for v1.0.

---

# Requirements: Prompt Template Resources

**Defined:** 2026-01-19
**Core Value:** Creators can monetize AI prompts — callers pay markup via x402, server executes with creator's API key, and the prompt stays secret.

> **Architecture Pivot (2026-01-19):** Changed from client-side execution (caller brings API key) to server-side execution (creator provides API key, encrypted storage). This follows the existing `prompt` resource type pattern and simplifies the caller experience.

## v1 Requirements

Requirements for initial release. Each maps to roadmap phases.

### Data Model

- [x] **DATA-01**: New resource type `prompt_template` added to resource types
- [x] **DATA-02**: Prompt template stores system_prompt (creator's IP, never exposed to callers)
- [x] **DATA-03**: Prompt template stores parameters array with name, description, required, default
- [x] **DATA-04**: Prompt template stores model (hardcoded to claude-sonnet-4-20250514 for v1)
- [x] **DATA-05**: Prompt template stores max_tokens setting
- [x] **DATA-06**: Prompt template stores allows_user_message flag for system+user mode
- [x] **DATA-07**: Creator's API key stored at user level (Dashboard > Integrations, encrypted)

### Creator Flow

- [x] **CRTR-01**: Creator can select "Prompt Template" when creating a new resource
- [x] **CRTR-02**: Creator can enter template name, description, and image
- [x] **CRTR-03**: Creator can write system prompt in a dedicated editor
- [x] **CRTR-04**: Editor highlights `{param}{/param}` syntax with distinct styling
- [x] **CRTR-05**: Creator can define parameters with name, description, required flag, and default value
- [x] **CRTR-06**: Creator can set price markup per run (in USDC)
- [x] **CRTR-07**: Creator can toggle allows_user_message for system+user mode
- [x] **CRTR-08**: Creator can enter their Claude API key (user-level integration)
- [x] **CRTR-09**: Creator can test template execution before publishing (via X-OWNER-TEST header)
- [x] **CRTR-10**: Creator can edit published template (updates in place)

### Caller Flow

- [x] **CALL-01**: Caller can view template detail page with name, description, params, price, usage count
- [x] **CALL-02**: Caller never sees the actual system prompt content
- [x] **CALL-03**: Caller can fill parameter values via auto-generated form
- [x] **CALL-04**: Required parameters are enforced, defaults are pre-filled
- [x] **CALL-05**: Caller can provide optional user message when allows_user_message is true
- [x] **CALL-06**: Caller pays creator's markup via x402 before execution
- [x] **CALL-07**: Response streams to UI in real-time
- [x] **CALL-08**: Caller can copy output to clipboard
- [x] **CALL-09**: ~~Caller can view their execution history for this template~~ (Out of scope - not needed)

### Execution Engine (Server-Side)

- [x] **EXEC-01**: Parameter substitution replaces `{param}{/param}` with provided values
- [x] **EXEC-02**: Missing required parameters throw validation error before payment
- [x] **EXEC-03**: Server decrypts creator's API key for execution
- [x] **EXEC-04**: Server calls Claude API using @anthropic-ai/sdk
- [x] **EXEC-05**: Streaming response proxied to caller in real-time
- [x] **EXEC-06**: Execution errors mapped to user-friendly messages
- [x] **EXEC-07**: Usage is logged (template_id, caller, success/fail, token counts)

### Workflow Integration

- [x] **WKFL-01 to WKFL-04**: Removed from scope — existing workflow builder handles all resource types uniformly

### Discovery

- [x] **DISC-01 to DISC-04**: Removed from scope — existing resource discovery handles all resource types uniformly

## Traceability

| Requirement | Phase   | Status             |
| ----------- | ------- | ------------------ |
| DATA-01     | Phase 1 | ✓ Complete         |
| DATA-02     | Phase 1 | ✓ Complete         |
| DATA-03     | Phase 1 | ✓ Complete         |
| DATA-04     | Phase 1 | ✓ Complete         |
| DATA-05     | Phase 1 | ✓ Complete         |
| DATA-06     | Phase 1 | ✓ Complete         |
| DATA-07     | Phase 2 | ✓ Complete         |
| CRTR-01     | Phase 2 | ✓ Complete         |
| CRTR-02     | Phase 2 | ✓ Complete         |
| CRTR-03     | Phase 2 | ✓ Complete         |
| CRTR-04     | Phase 2 | ✓ Complete         |
| CRTR-05     | Phase 2 | ✓ Complete         |
| CRTR-06     | Phase 2 | ✓ Complete         |
| CRTR-07     | Phase 2 | ✓ Complete         |
| CRTR-08     | Phase 2 | ✓ Complete         |
| CRTR-09     | Phase 3 | ✓ Complete         |
| CRTR-10     | Phase 2 | ✓ Complete         |
| CALL-01     | Phase 4 | ✓ Complete         |
| CALL-02     | Phase 4 | ✓ Complete         |
| CALL-03     | Phase 4 | ✓ Complete         |
| CALL-04     | Phase 4 | ✓ Complete         |
| CALL-05     | Phase 4 | ✓ Complete         |
| CALL-06     | Phase 5 | ✓ Complete         |
| CALL-07     | Phase 4 | ✓ Complete         |
| CALL-08     | Phase 4 | ✓ Complete         |
| CALL-09     | Phase 5 | Out of scope       |
| EXEC-01     | Phase 3 | ✓ Complete         |
| EXEC-02     | Phase 3 | ✓ Complete         |
| EXEC-03     | Phase 3 | ✓ Complete         |
| EXEC-04     | Phase 3 | ✓ Complete         |
| EXEC-05     | Phase 3 | ✓ Complete         |
| EXEC-06     | Phase 3 | ✓ Complete         |
| EXEC-07     | Phase 5 | ✓ Complete         |
| WKFL-\*     | N/A     | Removed from scope |
| DISC-\*     | N/A     | Removed from scope |

---

## Milestone Summary

**Shipped:** 32 of 33 Phase 1-5 requirements (CALL-09 out of scope)
**Scope changes:**

- WKFL-01 to WKFL-04: Removed — existing workflow builder handles prompt_template
- DISC-01 to DISC-04: Removed — existing discovery handles prompt_template
- CALL-09: Marked out of scope — not needed for v1

---

_Archived: 2026-01-20 as part of v1.0 milestone completion_
