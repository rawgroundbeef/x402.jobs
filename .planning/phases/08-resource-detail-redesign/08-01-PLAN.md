---
phase: 08-resource-detail-redesign
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/pages/ResourceDetailPage/ResourceDetailPage.tsx
  - src/lib/format.ts
autonomous: true

must_haves:
  truths:
    - "Owner sees three-dot dropdown menu with Edit and Delete options in top-right"
    - "Non-owners do not see the three-dot dropdown menu"
    - "Success rate displays warning icon + color for poor rates (0-50% red, 51-80% yellow)"
    - "Stats show sample size context as parenthetical (e.g., '0% success (13 calls)')"
  artifacts:
    - path: "src/components/pages/ResourceDetailPage/ResourceDetailPage.tsx"
      provides: "Refactored header with owner dropdown"
      contains: "MoreVertical"
    - path: "src/lib/format.ts"
      provides: "Enhanced success rate display with tiers"
      exports: ["getSuccessRateTier"]
  key_links:
    - from: "ResourceDetailPage.tsx"
      to: "@repo/ui/dropdown"
      via: "import { Dropdown, DropdownItem, DropdownDivider }"
      pattern: "Dropdown.*MoreVertical"
    - from: "ResourceDetailPage.tsx"
      to: "format.ts"
      via: "getSuccessRateTier import"
      pattern: "getSuccessRateTier"
---

<objective>
Restructure ResourceDetailPage header with owner dropdown menu and enhance success rate display with tiered warnings.

Purpose: Move owner actions (Edit/Delete) from prominent inline buttons to a three-dot dropdown menu following established codebase patterns. Add visual warning indicators for poor success rates to help users make informed decisions before paying.

Output: Updated ResourceDetailPage.tsx with header restructure, new getSuccessRateTier utility in format.ts.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-resource-detail-redesign/08-CONTEXT.md
@.planning/phases/08-resource-detail-redesign/08-RESEARCH.md
@src/components/pages/ResourceDetailPage/ResourceDetailPage.tsx
@src/lib/format.ts
@src/components/pages/AccountJobsPage/components/JobCard.tsx (dropdown pattern reference)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add getSuccessRateTier utility to format.ts</name>
  <files>src/lib/format.ts</files>
  <action>
Add a new exported function `getSuccessRateTier` that returns color, icon indicator, and background color based on success rate thresholds:

```typescript
export function getSuccessRateTier(rate: number): {
  color: string;
  bgColor: string;
  showWarning: boolean;
} {
  if (rate <= 50) {
    return {
      color: "text-red-600 dark:text-red-400",
      bgColor: "bg-red-500/10",
      showWarning: true,
    };
  }
  if (rate <= 80) {
    return {
      color: "text-yellow-600 dark:text-yellow-500",
      bgColor: "bg-yellow-500/10",
      showWarning: true,
    };
  }
  return {
    color: "text-emerald-600 dark:text-emerald-400",
    bgColor: "",
    showWarning: false,
  };
}
```

Thresholds per CONTEXT.md:

- 0-50%: Red with warning (critical)
- 51-80%: Yellow with warning (caution)
- 81%+: Green/neutral (no warning)

Place after existing `getSuccessRateColor` function. The existing function can remain for backward compatibility but is superseded by this new tiered version.
</action>
<verify>TypeScript compiles: `cd /Users/rawgroundbeef/Projects/memeputer/apps/x402-jobs && npx tsc --noEmit 2>&1 | head -20`</verify>
<done>getSuccessRateTier function exported from format.ts with correct tier thresholds</done>
</task>

<task type="auto">
  <name>Task 2: Replace inline owner buttons with three-dot dropdown menu</name>
  <files>src/components/pages/ResourceDetailPage/ResourceDetailPage.tsx</files>
  <action>
Refactor the header section to move owner actions into a dropdown menu:

1. **Add imports** at top:

   ```typescript
   import { Dropdown, DropdownItem, DropdownDivider } from "@repo/ui/dropdown";
   import { MoreVertical } from "lucide-react";
   import { AlertTriangle } from "lucide-react";
   import { getSuccessRateTier } from "@/lib/format";
   ```

2. **Restructure header** (around lines 804-976):

   Change the header from centered layout to flex with title on left, dropdown on right:

   ```tsx
   {/* Header Section */}
   <div className="py-10 md:py-12">
     {/* Top row: Avatar centered */}
     <div className="flex justify-center mb-5">
       <Avatar ... />
     </div>

     {/* Title row with owner dropdown */}
     <div className="flex items-start justify-center gap-4">
       <div className="text-center flex-1">
         <h1 className="text-2xl md:text-3xl font-bold font-mono mb-2">
           {/* Name with server link - keep existing logic */}
         </h1>

         {/* URL - keep existing */}
         <a href={resource.resource_url} ...>

         {/* Owner info - keep existing */}

         {/* Description - keep existing */}
       </div>

       {/* Owner dropdown - positioned at top right of title area */}
       {canEdit && (
         <Dropdown
           trigger={
             <Button variant="ghost" size="sm" className="h-8 w-8 p-0 flex-shrink-0">
               <MoreVertical className="h-4 w-4" />
             </Button>
           }
           placement="bottom-end"
         >
           <DropdownItem onClick={() => setShowEditModal(true)}>
             <span className="flex items-center gap-2">
               <Pencil className="h-4 w-4" />
               Edit
             </span>
           </DropdownItem>
           <DropdownDivider />
           <DropdownItem onClick={handleDeleteClick} className="text-destructive">
             <span className="flex items-center gap-2">
               <Trash2 className="h-4 w-4" />
               Delete
             </span>
           </DropdownItem>
         </Dropdown>
       )}
     </div>
   ```

3. **Remove the old owner action buttons** (lines ~951-971):
   Delete the entire block:

   ```tsx
   {/* Owner Actions */}
   {canEdit && (
     <div className="flex flex-wrap items-center justify-center gap-3 mt-4">
       <Button variant="outline" ... onClick={() => setShowEditModal(true)}>
         <Pencil ... /> Edit
       </Button>
       <Button variant="outline" ... onClick={handleDeleteClick}>
         <Trash2 ... /> Delete
       </Button>
     </div>
   )}
   ```

4. **Update stats line** (around lines 905-949) to use tiered warnings:

   Replace the existing success rate display with tiered version:

   ```tsx
   {
     /* Stats */
   }
   <p className="text-sm text-muted-foreground">
     {/* Success Rate with warning tier */}
     {(() => {
       const tier = getSuccessRateTier(successRateInfo.rate!);
       const totalCalls =
         (resource?.success_count_30d ?? 0) +
         (resource?.failure_count_30d ?? 0);

       if (successRateInfo.isNew) {
         return (
           <span className="inline-flex items-center px-1.5 py-0.5 rounded bg-muted text-xs font-medium mr-2">
             New
           </span>
         );
       }

       return (
         <>
           <span
             className={`inline-flex items-center gap-1 font-medium ${tier.color}`}
           >
             {tier.showWarning && <AlertTriangle className="w-3.5 h-3.5" />}
             {successRateInfo.text} success
             {totalCalls > 0 && (
               <span className="font-normal text-muted-foreground">
                 ({totalCalls} calls)
               </span>
             )}
           </span>
           <span className="mx-2">â€¢</span>
         </>
       );
     })()}
     {/* Rest of stats: price, network, badges - keep existing */}
   </p>;
   ```

Keep the earnings pill above stats (for owners) as-is since it's already working.
</action>
<verify>

1. TypeScript compiles: `cd /Users/rawgroundbeef/Projects/memeputer/apps/x402-jobs && npx tsc --noEmit 2>&1 | head -20`
2. Manual: Visit a resource detail page as owner - see three-dot menu with Edit/Delete
3. Manual: Visit same page logged out or as non-owner - no three-dot menu visible
4. Manual: Check a resource with low success rate shows warning icon
   </verify>
   <done>

- Owner actions moved to three-dot dropdown menu in header top-right
- Non-owners don't see the dropdown
- Success rate shows tiered warning colors and icons
- Sample size shows in parenthetical
  </done>
  </task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes without errors
2. Dev server runs: `npm run dev`
3. Visual checks:
   - Resource detail page loads without errors
   - Owner sees three-dot menu, non-owner does not
   - Low success rate (<=50%) shows red + warning icon
   - Medium success rate (51-80%) shows yellow + warning icon
   - High success rate (81%+) shows green, no warning icon
   - Sample size appears in parentheses after success rate
</verification>

<success_criteria>

1. Owner dropdown menu appears only for canEdit users
2. Edit and Delete work from dropdown menu
3. Success rate tiers display correctly with color + icon warnings
4. No TypeScript errors
5. No visual regressions on resource detail page
   </success_criteria>

<output>
After completion, create `.planning/phases/08-resource-detail-redesign/08-01-SUMMARY.md`
</output>
