---
phase: 19-wizard-shell-type-selection
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/src/lib/wizard-draft.ts
  - apps/web/src/components/wizard/WizardShell.tsx
autonomous: true

must_haves:
  truths:
    - "Session storage helpers correctly read/write/clear wizard draft data"
    - "WizardShell renders centered card layout with step indicator, back, and cancel buttons"
    - "Cancel button shows confirmation dialog when draft has meaningful data"
    - "Cancel button navigates directly to /resources when draft is empty"
    - "Back button navigates to previous step"
    - "Layout is mobile-responsive with constrained max-width"
  artifacts:
    - path: "apps/web/src/lib/wizard-draft.ts"
      provides: "Session storage helpers for wizard state"
      exports: ["getDraft", "saveDraft", "clearDraft", "hasUnsavedChanges", "WizardDraft"]
    - path: "apps/web/src/components/wizard/WizardShell.tsx"
      provides: "Reusable wizard layout wrapper with navigation controls"
      exports: ["WizardShell"]
  key_links:
    - from: "apps/web/src/components/wizard/WizardShell.tsx"
      to: "apps/web/src/lib/wizard-draft.ts"
      via: "imports hasUnsavedChanges and clearDraft"
      pattern: "import.*hasUnsavedChanges.*clearDraft.*wizard-draft"
---

<objective>
Build the wizard infrastructure: session storage helpers for draft persistence and the WizardShell layout component with navigation controls.

Purpose: Provides the reusable foundation that every wizard step page will wrap with. Session storage helpers enable state persistence across refreshes (WIZD-07). WizardShell provides the consistent centered card layout (WIZD-01), step indicator (WIZD-02), back button (WIZD-03), and cancel button with confirmation (WIZD-04).

Output: Two files — `wizard-draft.ts` (session storage utilities) and `WizardShell.tsx` (layout wrapper component).
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-wizard-shell-type-selection/19-CONTEXT.md
@.planning/phases/19-wizard-shell-type-selection/19-RESEARCH.md
@apps/web/src/app/globals.css
@packages/ui/src/button.tsx
@packages/ui/src/dialog.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create session storage draft helpers</name>
  <files>apps/web/src/lib/wizard-draft.ts</files>
  <action>
Create `apps/web/src/lib/wizard-draft.ts` with the following:

1. **WizardDraft interface** — typed shape of the wizard state:
   ```typescript
   export interface WizardDraft {
     type?: "link" | "proxy" | "claude" | "openrouter";
     name?: string;
     description?: string;
     slug?: string;
     // Step 2 type-specific config (added by later phases)
     linkConfig?: Record<string, unknown>;
     proxyConfig?: Record<string, unknown>;
     claudeConfig?: Record<string, unknown>;
     openrouterConfig?: Record<string, unknown>;
     // Step 3 details
     imageUrl?: string;
     category?: string;
     price?: string;
     network?: string;
     updatedAt: string;
   }
   ```

2. **DRAFT_KEY constant** — `"x402jobs:newResource"`

3. **getDraft()** — Returns `WizardDraft | null`. Checks `typeof window === "undefined"` for SSR safety. Wraps `sessionStorage.getItem` + `JSON.parse` in try/catch, returns null on error. Logs parse errors to console.

4. **saveDraft(updates: Partial<Omit<WizardDraft, "updatedAt">>)** — Merges updates into existing draft (or creates new). Always sets `updatedAt` to `new Date().toISOString()`. SSR safe.

5. **clearDraft()** — Removes the key from session storage. SSR safe.

6. **hasUnsavedChanges()** — Returns boolean. Gets draft, destructures out `updatedAt`, checks if remaining keys have values. A draft with only `type` set is NOT considered meaningful (easily re-selected). Meaningful = has `name`, or any `*Config` field, or `description`, `slug`, `price`.

Follow project conventions: double quotes, semicolons, 2-space indent, named exports, JSDoc on exported functions.
  </action>
  <verify>
Run `npx tsc --noEmit --project apps/web/tsconfig.json 2>&1 | grep wizard-draft` to check for type errors in the new file. Should return no errors (or only unrelated ones).
  </verify>
  <done>
wizard-draft.ts exports WizardDraft type and 4 functions (getDraft, saveDraft, clearDraft, hasUnsavedChanges) with SSR safety checks and proper TypeScript types.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create WizardShell layout component</name>
  <files>apps/web/src/components/wizard/WizardShell.tsx</files>
  <action>
Create `apps/web/src/components/wizard/WizardShell.tsx` as a "use client" component.

**Imports:**
- `useRouter` from `next/navigation`
- `useState` from `react`
- `ArrowLeft` from `lucide-react`
- `Button` from `@x402jobs/ui/button`
- `hasUnsavedChanges`, `clearDraft` from `@/lib/wizard-draft`

**Props interface (WizardShellProps):**
```typescript
interface WizardShellProps {
  children: React.ReactNode;
  step: number;
  totalSteps: number;
  title: string;
  onBack?: () => void;
  backHref?: string;
  showBack?: boolean;      // defaults to step > 1
  showCancel?: boolean;     // defaults to true
  footer?: React.ReactNode; // optional custom footer (e.g., Continue button)
}
```

**Layout structure:**
- Outer: `min-h-[calc(100vh-64px)]` (subtract nav bar height) with `bg-[#0a0f14] py-8`
- Inner: `max-w-[800px] mx-auto px-4`
- Card: `bg-[#111820] border border-[#252d3a] rounded-xl p-6 sm:p-8`
- Step indicator: `text-sm text-[#5c6670] mb-6` showing `Step {step} of {totalSteps}`
- Title: `text-2xl font-semibold text-white mb-6` showing `{title}`
- Children rendered in a `<div>` with no extra wrapper
- Navigation footer: `flex justify-between items-center pt-6 border-t border-[#252d3a] mt-8`
  - Left side: Back button (ghost variant) with ArrowLeft icon, shown when `showBack` is true (default: `step > 1`)
  - Right side: Cancel button (outline variant), shown when `showCancel` is true
  - If `footer` prop provided, render it between back and cancel (or in place of the default footer area as a flex row)

**Cancel behavior:**
- On click: check `hasUnsavedChanges()`
- If true: set `showCancelConfirm` state to true, render a simple confirmation overlay
- If false: navigate to `/resources` directly via `router.push("/resources")`
- Confirmation dialog: centered overlay with backdrop, card with "Discard this resource?" title, "Your progress will be lost." message, two buttons: "Discard" (destructive, calls `clearDraft()` then `router.push("/resources")`) and "Keep Editing" (outline, closes dialog)
- Style the confirmation dialog using the same dark theme colors (#111820 bg, #252d3a border), rendered as a fixed overlay with z-50

**Back behavior:**
- If `onBack` provided, call it
- Else if `backHref` provided, `router.push(backHref)`
- Else `router.back()`

Use the project's existing Button component variants (ghost for back, outline for cancel). Do NOT import from Radix Dialog — build the confirmation as a simple div overlay to keep it lightweight.
  </action>
  <verify>
Run `npx tsc --noEmit --project apps/web/tsconfig.json 2>&1 | grep WizardShell` to check for type errors. Should return no errors.
  </verify>
  <done>
WizardShell.tsx renders a centered card layout with step indicator ("Step N of M"), title, children slot, back button (with ArrowLeft icon), cancel button with confirmation dialog when draft has data, and optional footer slot for custom buttons. Mobile-responsive via padding adjustment (p-6 on mobile, p-8 on sm+).
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit --project apps/web/tsconfig.json` completes without errors in the new files
2. Both files use "use client" where needed (WizardShell.tsx yes, wizard-draft.ts no — it's a pure utility)
3. wizard-draft.ts has `typeof window === "undefined"` checks in all 4 functions
4. WizardShell.tsx imports from `next/navigation` (NOT `next/router`)
5. Button imports use `@x402jobs/ui/button` (project convention)
</verification>

<success_criteria>
- wizard-draft.ts exports WizardDraft type + getDraft/saveDraft/clearDraft/hasUnsavedChanges with SSR safety
- WizardShell.tsx renders centered dark-themed card with step indicator, title, children, back + cancel navigation
- Cancel shows confirmation dialog when hasUnsavedChanges() is true
- Both files pass TypeScript compilation
</success_criteria>

<output>
After completion, create `.planning/phases/19-wizard-shell-type-selection/19-01-SUMMARY.md`
</output>
