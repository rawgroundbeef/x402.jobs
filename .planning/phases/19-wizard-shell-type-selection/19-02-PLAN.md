---
phase: 19-wizard-shell-type-selection
plan: 02
type: execute
wave: 2
depends_on: ["19-01"]
files_modified:
  - apps/web/src/app/resources/new/page.tsx
  - apps/web/src/app/resources/new/link/page.tsx
  - apps/web/src/app/resources/new/proxy/page.tsx
  - apps/web/src/app/resources/new/claude/page.tsx
  - apps/web/src/app/resources/new/openrouter/page.tsx
  - apps/web/src/app/resources/new/details/page.tsx
  - apps/web/src/app/resources/new/review/page.tsx
autonomous: false

must_haves:
  truths:
    - "User navigates to /resources/new and sees a full-page wizard with Step 1 of 3 indicator"
    - "Four type cards are displayed: Link Existing (full-width primary), then Proxy, Claude, OpenRouter in a row below a divider"
    - "Clicking any type card saves the type to session storage and navigates to the correct URL (/resources/new/link, /proxy, /claude, /openrouter)"
    - "Refreshing /resources/new with an existing draft shows resume prompt with Continue Editing and Start Fresh options"
    - "Step 2 stub pages show the step indicator as Step 2 of 3 and have a working Back button to /resources/new"
    - "Deep linking to /resources/new/link without a draft redirects to /resources/new"
    - "Cancel button on any page returns to /resources with confirmation if draft has meaningful data"
  artifacts:
    - path: "apps/web/src/app/resources/new/page.tsx"
      provides: "Step 1: Type selection with 4 cards and resume prompt"
      min_lines: 80
    - path: "apps/web/src/app/resources/new/link/page.tsx"
      provides: "Step 2 stub for Link Existing path with deep link protection"
    - path: "apps/web/src/app/resources/new/proxy/page.tsx"
      provides: "Step 2 stub for Proxy path with deep link protection"
    - path: "apps/web/src/app/resources/new/claude/page.tsx"
      provides: "Step 2 stub for Claude Prompt path with deep link protection"
    - path: "apps/web/src/app/resources/new/openrouter/page.tsx"
      provides: "Step 2 stub for OpenRouter path with deep link protection"
    - path: "apps/web/src/app/resources/new/details/page.tsx"
      provides: "Step 3 stub for Details with deep link protection"
    - path: "apps/web/src/app/resources/new/review/page.tsx"
      provides: "Step 4 stub for Review with deep link protection"
  key_links:
    - from: "apps/web/src/app/resources/new/page.tsx"
      to: "apps/web/src/lib/wizard-draft.ts"
      via: "getDraft, saveDraft, clearDraft for draft management"
      pattern: "import.*getDraft.*saveDraft.*clearDraft.*wizard-draft"
    - from: "apps/web/src/app/resources/new/page.tsx"
      to: "apps/web/src/components/wizard/WizardShell.tsx"
      via: "wraps content in WizardShell"
      pattern: "import.*WizardShell.*wizard/WizardShell"
    - from: "apps/web/src/app/resources/new/link/page.tsx"
      to: "apps/web/src/lib/wizard-draft.ts"
      via: "getDraft for deep link protection"
      pattern: "getDraft.*wizard-draft"
---

<objective>
Build the type selection page (Step 1) with 4 resource type cards, draft resume prompt, and route stub pages for all wizard steps with deep link protection.

Purpose: This is the user-facing deliverable of Phase 19. Users see the wizard, choose a resource type, and navigate forward. Route stubs ensure URL routing works end-to-end and deep link protection redirects users without state back to Step 1. Covers requirements WIZD-01 through WIZD-08 and TYPE-01 through TYPE-04.

Output: 7 page files under `apps/web/src/app/resources/new/` forming the complete wizard route structure.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-wizard-shell-type-selection/19-CONTEXT.md
@.planning/phases/19-wizard-shell-type-selection/19-RESEARCH.md
@.planning/phases/19-wizard-shell-type-selection/19-01-SUMMARY.md
@apps/web/src/lib/wizard-draft.ts
@apps/web/src/components/wizard/WizardShell.tsx
@packages/ui/src/button.tsx
@apps/web/src/app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create type selection page with resume prompt</name>
  <files>apps/web/src/app/resources/new/page.tsx</files>
  <action>
Create `apps/web/src/app/resources/new/page.tsx` as a "use client" component.

**Imports:**
- `useRouter` from `next/navigation`
- `useEffect`, `useState` from `react`
- `getDraft`, `saveDraft`, `clearDraft`, `WizardDraft` from `@/lib/wizard-draft`
- `WizardShell` from `@/components/wizard/WizardShell`
- `Link2`, `Globe`, `Sparkles`, `Zap` from `lucide-react`
- `Button` from `@x402jobs/ui/button`
- `formatDistanceToNow` from `date-fns`

**Type aliases:**
```typescript
type ResourceType = "link" | "proxy" | "claude" | "openrouter";
```

**State management:**
- `draft` state (WizardDraft | null) initialized to null
- `isLoaded` state (boolean) initialized to false — prevents hydration mismatch
- `useEffect` on mount: load draft via `getDraft()`, set both states

**Resume prompt logic:**
When `isLoaded` is true and `draft?.type` exists, render a resume prompt INSTEAD of the type cards:
- Render inside WizardShell with step=1, totalSteps=3, title="Resume Draft?"
- Show: "You have an unfinished {formatted type name} resource" (map type to display name: link="Link Existing", proxy="Proxy", claude="Claude Prompt", openrouter="OpenRouter")
- If `draft.name` exists, append `: "{draft.name}"`
- If `draft.updatedAt` exists, show relative time: `(${formatDistanceToNow(new Date(draft.updatedAt))} ago)`
- Two buttons:
  - "Continue Editing" (primary variant) — navigates to `/resources/new/${draft.type}`
  - "Start Fresh" (outline variant) — calls `clearDraft()`, resets draft state to null

**Type selection (main view):**
When `isLoaded` is true and no draft with type exists, render inside WizardShell with step=1, totalSteps=3, title="Choose Resource Type". Pass `showBack={false}` since Step 1 has no previous step. Do NOT pass a footer prop — Step 1 has no Continue button (clicking a card navigates directly).

**Card layout:**
1. **Link Existing card** — full width at top, primary/emphasized:
   - `<button>` element, full width, `p-6 rounded-lg border border-[#252d3a]`
   - Hover: `hover:border-[#00d992] hover:bg-[#00d992]/5`
   - Focus: `focus:outline-none focus:ring-2 focus:ring-[#00d992] focus:ring-offset-2 focus:ring-offset-[#111820]`
   - Transition: `transition-colors duration-150`
   - Content: flex row with gap-4, icon (Link2 in `text-[#00d992]`), then title "Link Existing" (font-semibold text-white) + description "Connect your x402-enabled endpoint" (text-sm text-[#5c6670])
   - onClick: `handleSelectType("link")`

2. **Divider** — centered text with lines:
   - Flex row with `items-center gap-4 my-8`
   - Left line: `flex-1 h-px bg-[#252d3a]`
   - Text: `text-sm text-[#5c6670]` reading "or create something new"
   - Right line: `flex-1 h-px bg-[#252d3a]`

3. **Three create cards** — grid below divider:
   - `grid grid-cols-1 md:grid-cols-3 gap-4`
   - Each card: same button style as Link Existing but vertical layout (stacked icon + title + description)
   - Proxy: Globe icon, "Proxy", "Wrap any URL with payments"
   - Claude Prompt: Sparkles icon, "Claude Prompt", "Monetize a prompt"
   - OpenRouter: Zap icon, "OpenRouter", "Multi-model AI endpoint"

**handleSelectType function:**
```typescript
const handleSelectType = (type: ResourceType) => {
  saveDraft({ type });
  router.push(`/resources/new/${type}`);
};
```

**Loading state:** While `!isLoaded`, return `null` (prevents flash of content before session storage check). Session storage is synchronous so this is effectively instant.

**Accessibility:** All cards are `<button>` elements with proper focus states. Card content uses semantic heading (h3 for title).

Extract the card into an inline `TypeCard` component within the same file (not a separate file — keeps it simple for now). Props: `icon`, `title`, `description`, `onClick`, `className?`, `variant?: "horizontal" | "vertical"`. Link Existing uses horizontal (icon left, text right), create cards use vertical (icon top, text below center-aligned).
  </action>
  <verify>
Run `npx tsc --noEmit --project apps/web/tsconfig.json 2>&1 | grep "resources/new"` to check for type errors. Then run `npx next build --no-lint 2>&1 | tail -20` to verify the route compiles (or just check tsc is clean).
  </verify>
  <done>
Type selection page renders 4 cards (Link Existing full-width primary, 3 create cards in a row below "or create something new" divider), handles resume prompt for existing drafts, and navigates to type-specific Step 2 URLs on card click.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create route stub pages with deep link protection</name>
  <files>
    apps/web/src/app/resources/new/link/page.tsx
    apps/web/src/app/resources/new/proxy/page.tsx
    apps/web/src/app/resources/new/claude/page.tsx
    apps/web/src/app/resources/new/openrouter/page.tsx
    apps/web/src/app/resources/new/details/page.tsx
    apps/web/src/app/resources/new/review/page.tsx
  </files>
  <action>
Create 6 stub page files for all wizard routes. Each is a "use client" component with deep link protection.

**Pattern for Step 2 stubs (link, proxy, claude, openrouter):**
Each file follows the same pattern — create all four:

```typescript
"use client";

import { useEffect, useState } from "react";
import { useRouter } from "next/navigation";
import { getDraft } from "@/lib/wizard-draft";
import { WizardShell } from "@/components/wizard/WizardShell";

export default function {Type}ConfigPage() {
  const router = useRouter();
  const [isLoaded, setIsLoaded] = useState(false);

  useEffect(() => {
    const draft = getDraft();
    if (!draft?.type) {
      router.replace("/resources/new");
      return;
    }
    setIsLoaded(true);
  }, [router]);

  if (!isLoaded) return null;

  return (
    <WizardShell
      step={2}
      totalSteps={3}
      title="{Type Display Name} Configuration"
      backHref="/resources/new"
    >
      <div className="text-center py-12 text-[#5c6670]">
        <p className="text-lg mb-2">Coming in Phase {N}</p>
        <p className="text-sm">This step will be implemented in a future phase.</p>
      </div>
    </WizardShell>
  );
}
```

Specific titles per type:
- link: "Link Existing" — title "Configure Endpoint"
- proxy: "Proxy" — title "Configure Proxy"
- claude: "Claude Prompt" — title "Configure Prompt"
- openrouter: "OpenRouter" — title "Configure Model"

**Pattern for Step 3 stub (details):**
Same pattern but `step={3}`, title "Resource Details". Deep link check: `if (!draft?.type)` redirect.
The `backHref` should be dynamic based on draft type: ``/resources/new/${draft.type}``
So the details page needs to read the draft type first, then set backHref accordingly. Use a state variable for draft to hold the full draft object after load.

**Pattern for Step 4 stub (review):**
Same pattern but step={4} (note: step indicator should show "Step 3 of 3" for review since the step indicator counts user-visible steps — type selection, configuration, and details/review are the 3 steps the user sees). Actually, per the CONTEXT decisions the step indicator shows "Step 1 of 3" — meaning the 3 steps visible to the user are: Choose Type (1), Configure (2), Details (3). Review is Step 4 of 4 only if it's a separate visible step. Looking at the URL structure, there are 4 distinct pages (type, config, details, review). But CONTEXT says "Step 1 of 3" for the type page. Checking the requirements: WIZD-02 says "Step 1 of 3" — so the step indicator apparently counts as 3 total. This means details and review might be counted as one, or the step indicator skips one.

Resolution: The roadmap success criteria says "Step 1 of 3", so totalSteps=3 for the wizard. That means: Step 1 = Type, Step 2 = Configure, Step 3 = Details & Review combined (or Details is 3 and Review is part of it). For stub purposes:
- details page: step=3, totalSteps=3
- review page: step=3, totalSteps=3 (same step, sub-step)

Actually the simplest interpretation: the wizard shows 3 steps from the user perspective, and review is a sub-view of step 3. For stubs, just make details step=3 and review step=3 both with totalSteps=3. This can be refined in Phase 20.

Deep link check for review: `if (!draft?.type || !draft?.name)` — need at least type and name to be on review. For the stub, just check `!draft?.type`.

**Important:** Create the directories first. The file structure needs:
- `apps/web/src/app/resources/new/link/page.tsx`
- `apps/web/src/app/resources/new/proxy/page.tsx`
- `apps/web/src/app/resources/new/claude/page.tsx`
- `apps/web/src/app/resources/new/openrouter/page.tsx`
- `apps/web/src/app/resources/new/details/page.tsx`
- `apps/web/src/app/resources/new/review/page.tsx`

Each file should be minimal — just the deep link protection, WizardShell wrapper, and placeholder content. No actual form logic (that's Phase 20-24).
  </action>
  <verify>
Run `npx tsc --noEmit --project apps/web/tsconfig.json 2>&1 | grep "resources/new"` to check all 7 page files compile without errors. Verify all directories exist: `ls -R apps/web/src/app/resources/new/`.
  </verify>
  <done>
All 6 route stub pages exist with deep link protection (redirect to /resources/new if draft missing), WizardShell wrapper with correct step numbers and back navigation, and placeholder content indicating future implementation.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Full wizard shell with type selection (Step 1), session storage persistence, route stubs for all steps, and navigation controls.
  </what-built>
  <how-to-verify>
1. Start the dev server: `pnpm dev` (or however the project runs)
2. Navigate to `/resources/new` — verify you see a full-page wizard with:
   - "Step 1 of 3" indicator
   - "Choose Resource Type" title
   - Link Existing card (full width, green icon)
   - "or create something new" divider
   - 3 cards in a row: Proxy, Claude Prompt, OpenRouter
3. Click "Link Existing" card — verify URL changes to `/resources/new/link`, step shows "Step 2 of 3", and a stub message appears
4. Click Back button — verify you return to `/resources/new`
5. Click "Claude Prompt" card — verify URL changes to `/resources/new/claude`
6. Click Cancel — verify confirmation dialog appears ("Discard this resource?")
7. Click "Keep Editing" — dialog closes
8. Click Cancel again, then "Discard" — verify you land on `/resources` and draft is cleared
9. Navigate to `/resources/new` — verify NO resume prompt (draft was cleared)
10. Click any type card, then refresh the page — verify you stay on the stub page (session storage persisted)
11. Navigate to `/resources/new` — verify resume prompt appears with "Continue Editing" and "Start Fresh" options
12. Click "Start Fresh" — verify you see the type selection cards again
13. Test deep link: open `/resources/new/link` in a new tab (no session storage) — verify you're redirected to `/resources/new`
14. Test mobile: resize browser to narrow width — verify cards stack vertically
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues</resume-signal>
</task>

</tasks>

<verification>
1. All 7 page files exist under `apps/web/src/app/resources/new/`
2. `npx tsc --noEmit` passes without errors in new files
3. Navigating to `/resources/new` shows type selection wizard
4. Clicking type cards navigates to correct URLs and saves draft to session storage
5. Refreshing any page restores state from session storage
6. Deep linking without state redirects to Step 1
7. Cancel with data shows confirmation; cancel without data navigates directly
8. Resume prompt appears when returning to Step 1 with existing draft
9. Layout is responsive on mobile (cards stack)
</verification>

<success_criteria>
- /resources/new shows full-page wizard with 4 type cards matching the design spec (Link Existing primary, divider, 3 create cards in row)
- Clicking any card navigates to /resources/new/{type} with correct step indicator
- Session storage persists draft across page refreshes
- Resume prompt shows when returning with existing draft
- Deep link protection redirects to Step 1 when prerequisites missing
- Back, Cancel (with confirmation), and navigation all work correctly
- Mobile responsive (cards stack on narrow screens)
</success_criteria>

<output>
After completion, create `.planning/phases/19-wizard-shell-type-selection/19-02-SUMMARY.md`
</output>
