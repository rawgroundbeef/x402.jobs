---
phase: 21-link-existing-path
plan: 02
type: execute
wave: 2
depends_on: ["21-01"]
files_modified:
  - apps/web/src/app/dashboard/resources/new/details/page.tsx
  - apps/web/src/app/dashboard/resources/new/review/page.tsx
autonomous: false

must_haves:
  truths:
    - "Network field is read-only with '(Detected from endpoint)' label when pre-filled from Link Existing validation"
    - "Price field is read-only with '(Detected from endpoint)' label when pre-filled from Link Existing validation"
    - "User can still edit non-pre-filled fields (name, slug, description, image, category) normally"
    - "Review page shows validated endpoint URL and HTTP method in the Configuration section"
    - "User can complete full end-to-end flow: select Link Existing > enter URL > validate > fill details > review > publish"
  artifacts:
    - path: "apps/web/src/app/dashboard/resources/new/details/page.tsx"
      provides: "Details form with pre-fill support for network and price fields"
      contains: "preFilled"
    - path: "apps/web/src/app/dashboard/resources/new/review/page.tsx"
      provides: "Review page showing link config (URL + method) in Configuration section"
      contains: "linkConfig"
  key_links:
    - from: "apps/web/src/app/dashboard/resources/new/details/page.tsx"
      to: "apps/web/src/lib/wizard-draft.ts"
      via: "reads draft.preFilled to conditionally lock network/price fields"
      pattern: "preFilled"
    - from: "apps/web/src/app/dashboard/resources/new/review/page.tsx"
      to: "apps/web/src/lib/wizard-draft.ts"
      via: "reads draft.linkConfig to display validated URL and method"
      pattern: "linkConfig"
---

<objective>
Wire the pre-fill behavior into the details step and update the review page to show link-specific configuration. When a user validates a Link Existing endpoint, the detected network and price are locked (read-only) on the details form with "(Detected from endpoint)" labels. The review page shows the validated URL and HTTP method in its Configuration section instead of a placeholder.

Purpose: Completes the LINK-07 requirement (pre-fill) and makes the full Link Existing flow end-to-end functional through all 4 wizard steps.

Output: Modified details/page.tsx with pre-fill support, modified review/page.tsx with link config display.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-link-existing-path/21-CONTEXT.md
@.planning/phases/21-link-existing-path/21-RESEARCH.md
@.planning/phases/21-link-existing-path/21-01-SUMMARY.md
@apps/web/src/app/dashboard/resources/new/details/page.tsx
@apps/web/src/app/dashboard/resources/new/review/page.tsx
@apps/web/src/lib/wizard-draft.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add pre-fill support to details page and link config display to review page</name>
  <files>
    apps/web/src/app/dashboard/resources/new/details/page.tsx
    apps/web/src/app/dashboard/resources/new/review/page.tsx
  </files>
  <action>
**Details page modifications (details/page.tsx):**

Read the preFilled flags from the draft and conditionally lock the network and price fields.

1. After loading the draft in the useEffect, read `draft.preFilled` (the preFilled field added in plan 01).

2. Create a variable after draft loading: `const isPreFilled = draft?.preFilled || {}` — use this throughout.

3. **Network selector** — when `isPreFilled.network` is true:
   - Add "(Detected from endpoint)" label text after the "Network" label: `{isPreFilled.network && <span className="text-xs text-muted-foreground ml-2">(Detected from endpoint)</span>}`
   - Set the Select component to disabled: add `disabled={!!isPreFilled.network}` prop
   - Prevent onChange from firing when pre-filled: wrap the onChange handler to check `if (isPreFilled.network) return;` before calling setValue

4. **Price field** — when `isPreFilled.price` is true:
   - Add "(Detected from endpoint)" label text after the "Price (USDC)" label, same pattern as network
   - Add `disabled={!!isPreFilled.price}` and `readOnly={!!isPreFilled.price}` to the Input element
   - Note: both disabled and readOnly to prevent both click and programmatic changes

5. **Form default values** — the existing `draft?.price || ""` and `draft?.network || "base"` default values already pick up pre-filled values from session storage since plan 01 saved them to the draft. No change needed here.

6. **saveDraft in onSubmit** — preserve the preFilled flags and resourceUrl when saving. Update the onSubmit to spread the preFilled and resourceUrl from the existing draft:
   ```typescript
   saveDraft({
     name: data.name.trim(),
     slug: data.slug.trim(),
     description: data.description?.trim() || undefined,
     imageUrl: data.imageUrl || undefined,
     category: data.category,
     price: data.price,
     network: data.network,
     // Preserve link-specific fields from validation step
     ...(draft?.resourceUrl && { resourceUrl: draft.resourceUrl }),
     ...(draft?.preFilled && { preFilled: draft.preFilled }),
     ...(draft?.linkConfig && { linkConfig: draft.linkConfig }),
   });
   ```

**Review page modifications (review/page.tsx):**

Update the Configuration section to display actual link config instead of placeholder text.

1. Replace the link-specific placeholder at the bottom of the Configuration section. The current code has:
   ```tsx
   {draft.type === "link" && (
     <p className="text-xs text-muted-foreground mt-2">
       Validation details will display here for Link Existing resources
     </p>
   )}
   ```

   Replace it with actual link config display:
   ```tsx
   {draft.type === "link" && draft.linkConfig && (
     <div className="mt-3 space-y-2">
       <div>
         <dt className="text-sm text-muted-foreground">Endpoint URL</dt>
         <dd className="text-sm font-mono text-foreground break-all">
           {String(draft.linkConfig.url || draft.resourceUrl || '')}
         </dd>
       </div>
       {draft.linkConfig.method && (
         <div>
           <dt className="text-sm text-muted-foreground">HTTP Method</dt>
           <dd className="text-sm font-medium text-foreground">
             {String(draft.linkConfig.method)}
           </dd>
         </div>
       )}
     </div>
   )}
   ```

2. Also remove the existing separate block that already tries to show `draft.linkConfig?.url` (around lines 240-248) since the new block above replaces it. That block is:
   ```tsx
   {(() => {
     const url = draft.linkConfig?.url;
     if (typeof url === "string") {
       return (
         <p className="text-sm font-mono text-foreground mt-2">{url}</p>
       );
     }
     return null;
   })()}
   ```
   Remove this IIFE entirely — the new link config section covers it.

**Important:** Do NOT change the Select component API. The existing Select uses `value` and `onChange` props (not `register()`). Add `disabled` prop which should be supported. If the Select component doesn't support `disabled`, wrap it: when isPreFilled.network is true, add `pointer-events-none opacity-60` classes to the parent div and skip the onChange.
  </action>
  <verify>
1. TypeScript compiles: `cd /Users/rawgroundbeef/Projects/x402jobs && pnpm --filter web exec tsc --noEmit 2>&1 | head -30`
2. Dev server runs: `cd /Users/rawgroundbeef/Projects/x402jobs && pnpm --filter web dev &` — check no build errors
3. Manual test: Go through full Link Existing flow — validate an endpoint, confirm network/price are locked on details step, confirm review shows URL and method
  </verify>
  <done>
Details page locks network and price with "(Detected from endpoint)" when pre-filled from Link Existing validation.
Review page shows validated endpoint URL and HTTP method in Configuration section.
preFilled flags and linkConfig are preserved through the details step save.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Link Existing flow through the wizard: Type Selection -> Validate Endpoint -> Details (with pre-filled network/price) -> Review (with link config) -> Publish.
  </what-built>
  <how-to-verify>
1. Navigate to /dashboard/resources/new
2. Click "Link Existing" type card
3. Enter a known x402 endpoint URL (e.g., from x402check.com or your own)
4. Select HTTP method (GET is default)
5. Click "Validate Endpoint" — confirm:
   - Loading spinner shows during validation
   - Valid endpoint: green verdict banner with expandable sections (warnings, parsed config, endpoint checks, response body)
   - Invalid endpoint: red verdict banner with errors shown inline, Continue blocked
6. With valid result, click Continue
7. On Details step, confirm:
   - Network field is locked with "(Detected from endpoint)" label
   - Price field is locked with "(Detected from endpoint)" label
   - Other fields (name, slug, description, etc.) are editable normally
8. Fill required fields (name, slug auto-generates, category)
9. Click Continue to Review step
10. Confirm Configuration section shows the validated endpoint URL and HTTP method
11. (Optional) Click Publish to complete full flow
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
- `pnpm --filter web exec tsc --noEmit` passes with no errors
- Details page reads draft.preFilled and conditionally locks network/price fields
- Details page preserves resourceUrl, preFilled, and linkConfig through save
- Review page displays linkConfig.url and linkConfig.method in Configuration section
- Full end-to-end flow works: type selection -> validate -> details (pre-filled) -> review -> publish
</verification>

<success_criteria>
1. Network and price fields are read-only on details step when pre-filled from Link Existing validation (LINK-07)
2. "(Detected from endpoint)" label visible on locked fields
3. Review page shows endpoint URL and HTTP method (not placeholder text)
4. Full wizard flow completes end-to-end for Link Existing type
5. TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/21-link-existing-path/21-02-SUMMARY.md`
</output>
