---
phase: 01-database-schema
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/prompt-template.ts
autonomous: true

must_haves:
  truths:
    - "PromptTemplateParameter type exists with name, description, required, default fields"
    - "PromptTemplate type exists with system_prompt, parameters, model, max_tokens, allows_user_message"
    - "Zod schemas exist for runtime validation of prompt template data"
    - "Resource type union includes prompt_template option"
  artifacts:
    - path: "src/types/prompt-template.ts"
      provides: "TypeScript types and Zod schemas for prompt templates"
      exports: ["PromptTemplateParameter", "PromptTemplate", "promptTemplateParameterSchema", "promptTemplateSchema", "PromptTemplateResource"]
      min_lines: 60
  key_links:
    - from: "src/types/prompt-template.ts"
      to: "zod"
      via: "import { z } from 'zod'"
      pattern: "import.*z.*from.*zod"
---

<objective>
Create TypeScript types and Zod validation schemas for prompt templates.

Purpose: Establish type-safe foundation for prompt template feature. Types are used throughout the codebase for form validation, API responses, and component props.

Output: `src/types/prompt-template.ts` with all types and schemas needed for prompt templates.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-database-schema/01-RESEARCH.md

Reference existing patterns:
@src/types/dashboard.ts
@src/app/dashboard/resources/[id]/edit/page.tsx (lines 27-35 for PromptParameter pattern)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create prompt template types and Zod schemas</name>
  <files>src/types/prompt-template.ts</files>
  <action>
Create new file `src/types/prompt-template.ts` with:

1. **PromptTemplateParameter schema and type:**
   ```typescript
   import { z } from 'zod';

   export const promptTemplateParameterSchema = z.object({
     name: z.string().min(1, "Parameter name required"),
     description: z.string().default(""),
     required: z.boolean().default(true),
     default: z.string().optional(),
   });

   export type PromptTemplateParameter = z.infer<typeof promptTemplateParameterSchema>;
   ```

2. **PromptTemplate schema and type:**
   ```typescript
   export const promptTemplateSchema = z.object({
     system_prompt: z.string().min(1, "System prompt required"),
     parameters: z.array(promptTemplateParameterSchema).default([]),
     model: z.string().default('claude-sonnet-4-20250514'),
     max_tokens: z.number().int().min(1).max(8192).default(4096),
     allows_user_message: z.boolean().default(false),
   });

   export type PromptTemplate = z.infer<typeof promptTemplateSchema>;
   ```

3. **PromptTemplateResource interface** (full resource with prompt template fields):
   ```typescript
   export interface PromptTemplateResource {
     id: string;
     slug: string;
     name: string;
     description: string | null;
     resource_url: string;
     network: 'solana' | 'base';
     price_usdc: string;
     resource_type: 'prompt_template';
     avatar_url: string | null;
     category: string | null;
     created_at: string;
     is_active: boolean;
     call_count: number;
     total_earned_usdc: number;
     // Prompt template specific fields (prefixed with pt_)
     pt_system_prompt: string;
     pt_parameters: PromptTemplateParameter[];
     pt_model: string;
     pt_max_tokens: number;
     pt_allows_user_message: boolean;
   }
   ```

4. **PromptTemplatePublicView interface** (for callers - no system_prompt):
   ```typescript
   export interface PromptTemplatePublicView {
     id: string;
     slug: string;
     name: string;
     description: string | null;
     resource_url: string;
     network: 'solana' | 'base';
     price_usdc: string;
     avatar_url: string | null;
     category: string | null;
     // Parameters visible (for form generation)
     parameters: PromptTemplateParameter[];
     model: string;
     max_tokens: number;
     allows_user_message: boolean;
     // Stats
     usage_count?: number;
   }
   ```

5. **ResourceType union** (add to enable type checking):
   ```typescript
   export type ResourceType = 'external' | 'proxy' | 'prompt' | 'static' | 'prompt_template';
   ```

6. **Creation schema** (for form submission):
   ```typescript
   export const createPromptTemplateSchema = z.object({
     name: z.string().min(1, "Name is required").max(100),
     slug: z.string().min(1).max(60).regex(/^[a-z0-9]+(?:-[a-z0-9]+)*$/, "Use lowercase letters, numbers, and hyphens only"),
     description: z.string().max(500).optional(),
     category: z.string().min(1, "Category is required"),
     avatar_url: z.string().url().optional().or(z.literal("")),
     price_usdc: z.string().refine(val => !val || parseFloat(val) >= 0.001, "Price must be at least $0.001"),
     network: z.enum(['base', 'solana']),
     system_prompt: z.string().min(1, "System prompt is required"),
     parameters: z.array(promptTemplateParameterSchema).default([]),
     max_tokens: z.number().int().min(1).max(8192).default(4096),
     allows_user_message: z.boolean().default(false),
   });

   export type CreatePromptTemplateInput = z.infer<typeof createPromptTemplateSchema>;
   ```

**Important:**
- Use `pt_` prefix for database fields (matches research recommendation)
- Model is hardcoded to `claude-sonnet-4-20250514` in defaults (DATA-04)
- Do NOT add `type` field to parameters - simplified from existing `prompt` type (which had string/number/boolean)
- Parameters for prompt_template only have: name, description, required, default (all string-based substitution)
  </action>
  <verify>
1. File exists: `ls -la src/types/prompt-template.ts`
2. TypeScript compiles: `npx tsc --noEmit src/types/prompt-template.ts 2>&1 | head -20`
3. Exports are correct: `grep -E "^export (type|interface|const)" src/types/prompt-template.ts`
  </verify>
  <done>
- PromptTemplateParameter type has name, description, required, default fields (DATA-03)
- PromptTemplate type has system_prompt, parameters, model, max_tokens, allows_user_message (DATA-02, DATA-03, DATA-04, DATA-05, DATA-06)
- Zod schemas provide runtime validation
- ResourceType union includes 'prompt_template' (DATA-01)
- PromptTemplatePublicView excludes system_prompt (security requirement)
  </done>
</task>

</tasks>

<verification>
1. TypeScript compilation succeeds with no errors
2. All required types are exported
3. Zod schemas can be imported and used for validation
4. Types match the requirements from DATA-01 through DATA-06
</verification>

<success_criteria>
- [ ] `src/types/prompt-template.ts` exists with all types and schemas
- [ ] TypeScript compilation passes
- [ ] PromptTemplateParameter has: name, description, required, default
- [ ] PromptTemplate has: system_prompt, parameters, model, max_tokens, allows_user_message
- [ ] ResourceType includes 'prompt_template'
- [ ] PromptTemplatePublicView excludes system_prompt
</success_criteria>

<output>
After completion, create `.planning/phases/01-database-schema/01-01-SUMMARY.md`
</output>
