---
phase: 18-resource-display
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/x402-jobs/src/components/pages/ResourceDetailPage/ResourceDetailPage.tsx
  - apps/x402-jobs/src/components/lro/ResultDisplay.tsx
  - apps/x402-jobs/src/components/ResourceCard/ResourceCard.tsx
  - apps/x402-jobs/src/app/dashboard/resources/page.tsx
autonomous: true

must_haves:
  truths:
    - "OpenRouter resources appear in Explore listings and dashboard"
    - "OpenRouter resource detail page shows model name and provider"
    - "Caller can fill parameter form on OpenRouter resource"
    - "Caller can execute OpenRouter resource and see results"
    - "Image results display inline in result area"
  artifacts:
    - path: "src/components/pages/ResourceDetailPage/ResourceDetailPage.tsx"
      provides: "isOpenRouter discriminated union handling"
      contains: "isOpenRouter"
    - path: "src/components/lro/ResultDisplay.tsx"
      provides: "OpenRouter images array handling"
      contains: "images"
    - path: "src/components/ResourceCard/ResourceCard.tsx"
      provides: "OpenRouter resource type display"
      contains: "openrouter_instant"
  key_links:
    - from: "ResourceDetailPage"
      to: "ResultDisplay"
      via: "lro.result pass-through"
      pattern: "ResultDisplay.*result"
    - from: "ResourceDetailPage"
      to: "/api/execute"
      via: "authenticatedFetch"
      pattern: "authenticatedFetch.*execute"
---

<objective>
Extend resource display components to handle OpenRouter instant resources.

Purpose: Complete the OpenRouter v1.4 integration by enabling callers to discover, view, and execute OpenRouter resources through the existing UI patterns.

Output: OpenRouter resources visible in listings with execution capability via existing patterns.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-resource-display/18-CONTEXT.md
@.planning/phases/18-resource-display/18-RESEARCH.md
@.planning/phases/16-execution-backend/16-01-SUMMARY.md
@.planning/phases/17-rich-media-output/17-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend ResourceDetailPage for OpenRouter resources</name>
  <files>apps/x402-jobs/src/components/pages/ResourceDetailPage/ResourceDetailPage.tsx</files>
  <action>
Add OpenRouter instant resource support following the existing prompt_template pattern:

1. Add `isOpenRouter` discriminated union check (line ~334):
   ```typescript
   const isOpenRouter = resource?.resource_type === "openrouter_instant";
   ```

2. Update ResourceData interface to include OpenRouter-specific fields:
   - `openrouter_model_id?: string` - FK to ai_models
   - `model_name?: string` - Display name (from joined ai_models)
   - `model_provider?: string` - Provider name (from joined ai_models)
   - `model_context_length?: number` - Context window size

3. Update all `isPromptTemplate` conditionals to include `isOpenRouter`:
   - Line ~402: `if (!resource?.parameters || !(isPromptTemplate || isOpenRouter)) return;`
   - Line ~414: `}, [resource?.parameters, isPromptTemplate, isOpenRouter]);`
   - Line ~511: `if (isPromptTemplate || isOpenRouter) {`
   - Line ~528: `if (isPromptTemplate || isOpenRouter) {`
   - Line ~668: `...((isPromptTemplate || isOpenRouter) && {`
   - Line ~1047: Update button label logic
   - Line ~1116: `{(isPromptTemplate || isOpenRouter) && sortedPtParameters.length > 0 && (`
   - Line ~1169: `{!(isPromptTemplate || isOpenRouter) && hasInputs ? (`

4. Add model info display section in the detail header (after description, before Action Zone):
   ```tsx
   {isOpenRouter && resource?.model_name && (
     <div className="flex items-center gap-2 text-sm text-muted-foreground">
       <Network className="h-4 w-4 text-indigo-500" />
       <span>{resource.model_name}</span>
       {resource.model_provider && (
         <span className="text-xs bg-muted px-2 py-0.5 rounded">
           {resource.model_provider}
         </span>
       )}
     </div>
   )}
   ```

5. Import Network icon from lucide-react (already used elsewhere in codebase).

6. Update handleCreateJob to include openrouter_instant resource_type in workflow_data (similar to prompt_template handling at line ~668).

Follow the exact same parameter form and execution flow as prompt_template - both use pt_parameters and LRO polling.
  </action>
  <verify>
- `npm run build` succeeds
- Search for "isOpenRouter" returns matches in ResourceDetailPage.tsx
- No TypeScript errors in the file
  </verify>
  <done>
- isOpenRouter discriminated union added and used in all prompt_template conditionals
- Model info display section renders for OpenRouter resources
- OpenRouter resources can use parameter form and execution flow
  </done>
</task>

<task type="auto">
  <name>Task 2: Extend ResultDisplay for OpenRouter multi-modal responses</name>
  <files>apps/x402-jobs/src/components/lro/ResultDisplay.tsx</files>
  <action>
Extend ResultDisplay to handle OpenRouter's structured response format with `modality` and `images` array.

1. Update the artifact extraction logic (useMemo around line 68-85) to check for OpenRouter's `images` array:
   ```typescript
   const { artifactUrl, message, images } = useMemo(() => {
     const data = result.fullData as Record<string, unknown> | null;
     if (!data || typeof data !== "object") {
       return { artifactUrl: null, message: result.response, images: null };
     }

     // Check for OpenRouter images array first (from Phase 17)
     const imagesArray = data.images as string[] | undefined;

     // Check for imageDataUrl (base64), then other URL fields
     const url = (data.imageDataUrl ||
       data.artifactUrl ||
       data.imageUrl ||
       data.url ||
       (imagesArray && imagesArray[0])) as string | undefined;
     const msg = (data.response || data.message) as string | undefined;

     return {
       artifactUrl: url && typeof url === "string" ? url : null,
       message: msg || result.response,
       images: imagesArray && imagesArray.length > 0 ? imagesArray : null,
     };
   }, [result]);
   ```

2. Add images gallery rendering for multiple images (after the single artifact preview, around line 163):
   ```tsx
   {/* Multiple images gallery (OpenRouter image models) */}
   {images && images.length > 1 && (
     <div className="grid grid-cols-2 gap-2 mb-3">
       {images.map((imgUrl, idx) => (
         <a
           key={idx}
           href={imgUrl}
           target="_blank"
           rel="noopener noreferrer"
           className="block"
         >
           <img
             src={imgUrl}
             alt={`Generated image ${idx + 1}`}
             className="rounded-lg w-full h-auto border border-border"
           />
         </a>
       ))}
     </div>
   )}
   ```

3. The existing retry logic and loading states will work for OpenRouter images automatically - they use the same CDN patterns.

Note: OpenRouter returns images in `result.fullData.images` array (from Phase 17's extractMediaFromResponse helper).
  </action>
  <verify>
- `npm run build` succeeds
- Search for "images" in ResultDisplay.tsx shows the new gallery handling
- TypeScript types are correct (no errors)
  </verify>
  <done>
- ResultDisplay extracts `images` array from OpenRouter responses
- Single image displays inline (existing behavior)
- Multiple images display in 2-column grid gallery
  </done>
</task>

<task type="auto">
  <name>Task 3: Add OpenRouter type support to ResourceCard and dashboard</name>
  <files>apps/x402-jobs/src/components/ResourceCard/ResourceCard.tsx, apps/x402-jobs/src/app/dashboard/resources/page.tsx</files>
  <action>
Add OpenRouter instant resource type recognition to listing components.

**ResourceCard.tsx:**

1. Add `resource_type` to ResourceCardData interface:
   ```typescript
   resource_type?: "external" | "proxy" | "prompt" | "static" | "prompt_template" | "openrouter_instant";
   ```

2. Add OpenRouter badge display (after A2A badge, around line 193):
   ```tsx
   {/* OpenRouter Badge */}
   {resource.resource_type === "openrouter_instant" && (
     <span
       className="inline-flex items-center px-1.5 py-0.5 rounded text-[10px] font-bold bg-indigo-500/15 text-indigo-600 dark:text-indigo-400 border border-indigo-500/20"
       title="OpenRouter AI Model"
     >
       AI
     </span>
   )}
   ```

3. Import Network icon is NOT needed for the badge (using text "AI" keeps it simple and consistent with A2A badge pattern).

**dashboard/resources/page.tsx:**

1. Update Resource interface resource_type union (line 40):
   ```typescript
   resource_type: "external" | "proxy" | "prompt" | "prompt_template" | "static" | "openrouter_instant";
   ```

2. Update RESOURCE_TYPE_LABELS (line 69):
   ```typescript
   const RESOURCE_TYPE_LABELS = {
     external: "External",
     proxy: "Created",
     prompt: "Prompt",
     prompt_template: "Claude Prompt",
     openrouter_instant: "OpenRouter",
     static: "Static",
   };
   ```

3. The existing filtering and display logic will automatically work for openrouter_instant resources since they follow the same patterns.

4. Update CreateResourceModal editResource type (around line 805) to include openrouter_instant:
   ```typescript
   resource_type: editingResource.resource_type as
     | "external"
     | "proxy"
     | "prompt_template"
     | "openrouter_instant",
   ```
  </action>
  <verify>
- `npm run build` succeeds
- Search for "openrouter_instant" returns matches in both files
- RESOURCE_TYPE_LABELS includes OpenRouter entry
  </verify>
  <done>
- ResourceCard shows "AI" badge for OpenRouter resources
- Dashboard resources page recognizes openrouter_instant type
- Type labels display "OpenRouter" for openrouter_instant resources
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Build verification:**
   ```bash
   npm run build
   ```
   Must complete without errors.

2. **Type verification:**
   ```bash
   npx tsc --noEmit
   ```
   No type errors.

3. **Pattern verification:**
   - `grep -r "isOpenRouter" src/` shows usage in ResourceDetailPage
   - `grep -r "openrouter_instant" src/components/` shows type recognition
   - `grep -r "images" src/components/lro/ResultDisplay.tsx` shows array handling
</verification>

<success_criteria>
1. OpenRouter resources appear in Explore listings with "AI" badge
2. Dashboard resources page shows OpenRouter resources with "OpenRouter" type label
3. Resource detail page displays model name and provider for OpenRouter resources
4. Parameter form renders correctly for OpenRouter resources (same as prompt_template)
5. Execution flow works: fill params -> submit -> LRO polling -> result display
6. Image results from OpenRouter display inline in ResultDisplay
7. Multiple images display in 2-column grid gallery
8. All existing prompt_template functionality unchanged
</success_criteria>

<output>
After completion, create `.planning/phases/18-resource-display/18-01-SUMMARY.md` using the summary template.
</output>
