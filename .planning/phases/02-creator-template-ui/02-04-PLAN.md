---
phase: 02-creator-template-ui
plan: 04
type: execute
wave: 4
depends_on: ["02-03"]
files_modified:
  - src/components/pages/AccountIntegrationsPage/AccountIntegrationsPage.tsx
  - src/components/pages/AccountIntegrationsPage/components/ClaudeCard.tsx
  - src/components/modals/CreateResourceModal.tsx
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User can configure their Claude API key in Dashboard > Integrations"
    - "Claude integration card shows Connected status when key is set"
    - "CreateResourceModal shows warning when creating prompt template without Claude integration"
    - "Warning links to integrations page to configure API key"
  artifacts:
    - path: "src/components/pages/AccountIntegrationsPage/components/ClaudeCard.tsx"
      provides: "Claude API key integration card"
      contains: "ClaudeCard"
    - path: "src/components/pages/AccountIntegrationsPage/AccountIntegrationsPage.tsx"
      provides: "Integrations page with Claude card"
      contains: "ClaudeCard"
    - path: "src/components/modals/CreateResourceModal.tsx"
      provides: "Warning for missing Claude integration"
      contains: "claude.*integration"
  key_links:
    - from: "ClaudeCard.tsx"
      to: "/integrations/claude/config"
      via: "authenticatedFetch PUT"
      pattern: "integrations/claude/config"
---

<objective>
Add Claude API key as a user-level integration, following the existing TelegramCard pattern.

Purpose: CRTR-08 (Creator can enter their Claude API key) completed at user level instead of per-template. This is better UX - enter once, use for all templates. DATA-07 becomes user-level storage instead of template-level.

Output: User configures Claude API key once in Dashboard > Integrations. CreateResourceModal checks for integration and shows helpful warning if missing.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-creator-template-ui/02-CONTEXT.md
@src/components/pages/AccountIntegrationsPage/AccountIntegrationsPage.tsx
@src/components/pages/AccountIntegrationsPage/components/TelegramCard.tsx
@src/components/modals/CreateResourceModal.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ClaudeCard integration component</name>
  <files>src/components/pages/AccountIntegrationsPage/components/ClaudeCard.tsx</files>
  <action>
Create ClaudeCard.tsx following the TelegramCard pattern:

1. Create the component with:
   - SWR fetch from `/integrations/claude/config`
   - Config interface: `{ hasApiKey: boolean, isEnabled: boolean }`
   - Edit mode for entering/updating API key
   - PUT to `/integrations/claude/config` with `{ apiKey: string, isEnabled: boolean }`
   - "Leave blank to keep existing" message when updating
   - "Connected" badge when configured
   - Anthropic/Claude icon (sparkles or brain icon from lucide)

2. Follow exact pattern from TelegramCard:
   - Same state management (isEditing, isSaving, error, success)
   - Same Card layout structure
   - Same Button variants and positions
   - Password input for API key
   - Link to Anthropic Console for getting key

3. Styling:
   - Use purple accent color to match prompt template theme
   - Icon: Use Sparkles from lucide-react (represents AI)
     </action>
     <verify>

- ClaudeCard.tsx exists and exports default component
- Uses SWR to fetch `/integrations/claude/config`
- Has edit mode with password input for API key
- Shows "Connected" badge when hasApiKey is true
- Includes link to Anthropic Console
  </verify>
  <done>ClaudeCard component created following TelegramCard pattern</done>
  </task>

<task type="auto">
  <name>Task 2: Add ClaudeCard to AccountIntegrationsPage</name>
  <files>src/components/pages/AccountIntegrationsPage/AccountIntegrationsPage.tsx</files>
  <action>
1. Import ClaudeCard from ./components/ClaudeCard

2. Add ClaudeCard to the page, positioned logically with other cards:

   ```tsx
   <ClaudeCard />
   <TelegramCard />
   <XCard />
   ```

3. Update the page description to mention AI integrations:
   ```tsx
   <p className="text-sm text-muted-foreground">
     Connect external services and AI providers.
   </p>
   ```
   </action>
   <verify>

- AccountIntegrationsPage imports ClaudeCard
- ClaudeCard renders on the page
- Page description updated
  </verify>
  <done>ClaudeCard added to Integrations page</done>
  </task>

<task type="auto">
  <name>Task 3: Add Claude integration check to CreateResourceModal</name>
  <files>src/components/modals/CreateResourceModal.tsx</files>
  <action>
1. Add SWR hook to fetch Claude integration status:
   ```tsx
   const { data: claudeIntegration } = useSWR<{ hasApiKey: boolean }>(
     resourceType === "prompt_template" ? "/integrations/claude/config" : null,
     authenticatedFetcher
   );
   ```

2. Add warning alert when creating prompt template without Claude integration:

   ```tsx
   {
     resourceType === "prompt_template" &&
       claudeIntegration &&
       !claudeIntegration.hasApiKey && (
         <Alert className="mb-4">
           <AlertCircle className="h-4 w-4" />
           <AlertDescription>
             You need to configure your Claude API key before creating prompt
             templates.{" "}
             <Link
               href="/dashboard/integrations"
               className="text-primary hover:underline font-medium"
             >
               Configure in Settings â†’
             </Link>
           </AlertDescription>
         </Alert>
       );
   }
   ```

3. Disable submit button when Claude integration is missing:
   - Add to disabled condition: `|| (resourceType === "prompt_template" && !isEditMode && claudeIntegration && !claudeIntegration.hasApiKey)`

4. Import Link from next/link and Alert components if not already imported.
   </action>
   <verify>

- SWR fetches Claude integration status when prompt_template selected
- Warning alert shows when Claude integration missing
- Submit button disabled without Claude integration
- Link navigates to integrations page
  </verify>
  <done>CreateResourceModal checks for Claude integration before allowing prompt template creation</done>
  </task>

</tasks>

<verification>
1. Type checking: `npm run typecheck` passes
2. Build: `npm run build` succeeds
3. Manual test:
   - Go to Dashboard > Integrations
   - Verify Claude card appears
   - Configure API key (use test key or real key)
   - Verify "Connected" badge appears
   - Go to Create Resource > Prompt Template
   - If no Claude integration: see warning and disabled button
   - If Claude configured: can proceed with creation
</verification>

<success_criteria>

- [ ] ClaudeCard.tsx exists with proper structure
- [ ] ClaudeCard shows on Integrations page
- [ ] ClaudeCard has edit mode for API key entry
- [ ] ClaudeCard shows "Connected" when configured
- [ ] CreateResourceModal fetches Claude integration status
- [ ] Warning shows when Claude integration missing
- [ ] Submit disabled without Claude integration
- [ ] TypeScript compiles without errors
- [ ] Build succeeds
      </success_criteria>

<output>
After completion, create `.planning/phases/02-creator-template-ui/02-04-SUMMARY.md`
</output>
