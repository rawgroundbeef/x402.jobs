---
phase: 14-model-browser-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/x402-jobs-api/src/routes/ai-models.ts
  - apps/x402-jobs-api/src/index.ts
  - apps/x402-jobs/src/components/icons/ProviderIcons.tsx
  - apps/x402-jobs/src/hooks/useAIModelsQuery.ts
autonomous: true

must_haves:
  truths:
    - "API returns list of AI models from database"
    - "Frontend can fetch models with SWR hook"
    - "Provider icons render for major AI providers"
  artifacts:
    - path: "apps/x402-jobs-api/src/routes/ai-models.ts"
      provides: "GET /api/v1/ai-models endpoint"
      exports: ["aiModelsRouter"]
    - path: "apps/x402-jobs/src/components/icons/ProviderIcons.tsx"
      provides: "AI provider SVG icons"
      exports:
        [
          "ProviderIcon",
          "AnthropicIcon",
          "OpenAIIcon",
          "GoogleIcon",
          "MetaIcon",
          "MistralIcon",
          "XAIIcon",
        ]
    - path: "apps/x402-jobs/src/hooks/useAIModelsQuery.ts"
      provides: "SWR hook for ai_models data"
      exports: ["useAIModelsQuery", "AIModel"]
  key_links:
    - from: "apps/x402-jobs/src/hooks/useAIModelsQuery.ts"
      to: "/api/v1/ai-models"
      via: "SWR fetch"
      pattern: "useSWR.*ai-models"
    - from: "apps/x402-jobs-api/src/index.ts"
      to: "aiModelsRouter"
      via: "router registration"
      pattern: "app\\.use.*ai-models"
---

<objective>
Create backend API endpoint for AI models and supporting frontend infrastructure.

Purpose: Provide data layer for Model Browser UI (Plan 02 depends on this)
Output: Working GET /api/v1/ai-models endpoint, SWR hook, and provider icons
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-model-browser-ui/14-CONTEXT.md
@.planning/phases/14-model-browser-ui/14-RESEARCH.md
@.planning/phases/12-model-catalog-sync/12-01-SUMMARY.md

# Schema reference

@migrations/006_add_ai_models_curation.sql
@apps/x402-jobs/src/components/icons/ChainIcons.tsx
@apps/x402-jobs/src/components/icons/SocialIcons.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create GET /api/v1/ai-models endpoint</name>
  <files>apps/x402-jobs-api/src/routes/ai-models.ts, apps/x402-jobs-api/src/index.ts</files>
  <action>
Create a new route file `ai-models.ts` that provides:

1. **GET /api/v1/ai-models** - Public endpoint (no auth required) returning all active AI models

Response schema:

```typescript
interface AIModelsResponse {
  models: AIModel[];
}

interface AIModel {
  id: string;
  openrouter_id: string;
  display_name: string;
  description: string | null;
  provider: string;
  modality: "text" | "image" | "video" | "audio" | "embedding" | "multimodal";
  is_curated: boolean;
  context_length: number | null;
  pricing_prompt: string | null; // Cost per token (prompt)
  pricing_completion: string | null; // Cost per token (completion)
  vision_supported: boolean;
  web_search_supported: boolean;
  tool_calling_supported: boolean;
}
```

Implementation:

- Query `ai_models` table WHERE `is_active = true`
- Order by `display_name ASC`
- Select only needed columns (exclude timestamps, internal fields)
- Use existing supabase client pattern from other routes

Register the router in `index.ts`:

- Import aiModelsRouter from './routes/ai-models'
- Add `app.use('/api/v1/ai-models', aiModelsRouter)`

Follow patterns from `apps/x402-jobs-api/src/routes/resources.ts` for router structure.
</action>
<verify>

1. `curl http://localhost:3001/api/v1/ai-models` returns 200 with models array
2. Response includes expected fields: id, openrouter_id, display_name, provider, modality, is_curated
3. TypeScript compiles without errors
   </verify>
   <done>
   GET /api/v1/ai-models endpoint returns active AI models with all required fields for browser UI
   </done>
   </task>

<task type="auto">
  <name>Task 2: Create ProviderIcons component</name>
  <files>apps/x402-jobs/src/components/icons/ProviderIcons.tsx</files>
  <action>
Create ProviderIcons.tsx following ChainIcons.tsx pattern:

```typescript
interface IconProps {
  className?: string;
}

// Export individual icons for major AI providers:
// - AnthropicIcon (orange #D97706)
// - OpenAIIcon (black/white)
// - GoogleIcon (multicolor - reuse from SocialIcons if available)
// - MetaIcon (blue #0668E1)
// - MistralIcon (orange #F7A81B)
// - XAIIcon (neutral/gray)
// - StabilityIcon (purple #7C3AED) - for Stability AI image models
// - CohereIcon (orange #F97316)

// Helper component with fallback:
export function ProviderIcon({ provider, className }: { provider: string; className?: string }) {
  const normalized = provider.toLowerCase();

  if (normalized === 'anthropic') return <AnthropicIcon className={className} />;
  if (normalized === 'openai') return <OpenAIIcon className={className} />;
  if (normalized === 'google') return <GoogleIcon className={className} />;
  if (normalized === 'meta' || normalized === 'meta-llama') return <MetaIcon className={className} />;
  if (normalized === 'mistralai' || normalized === 'mistral') return <MistralIcon className={className} />;
  if (normalized === 'x-ai' || normalized === 'xai') return <XAIIcon className={className} />;
  if (normalized.includes('stability')) return <StabilityIcon className={className} />;
  if (normalized === 'cohere') return <CohereIcon className={className} />;

  // Fallback for unknown providers - use Box icon from lucide
  return <DefaultProviderIcon className={className} />;
}
```

Use simple SVG paths for icons. Keep icons monochrome (use currentColor) for flexibility.
Reference LobeHub icons or similar open sources for accurate SVG paths.
DefaultProviderIcon should be a simple box/cube shape.
</action>
<verify>

1. Import ProviderIcon in a test component and render with provider="anthropic"
2. TypeScript compiles without errors
3. All exported icons render without visual errors
   </verify>
   <done>
   ProviderIcon component renders appropriate icon for major AI providers with fallback for unknown
   </done>
   </task>

<task type="auto">
  <name>Task 3: Create useAIModelsQuery SWR hook</name>
  <files>apps/x402-jobs/src/hooks/useAIModelsQuery.ts</files>
  <action>
Create SWR hook for fetching AI models:

```typescript
import useSWR from "swr";
import { publicFetcher } from "@/lib/api";

export interface AIModel {
  id: string;
  openrouter_id: string;
  display_name: string;
  description: string | null;
  provider: string;
  modality: "text" | "image" | "video" | "audio" | "embedding" | "multimodal";
  is_curated: boolean;
  context_length: number | null;
  pricing_prompt: string | null;
  pricing_completion: string | null;
  vision_supported: boolean;
  web_search_supported: boolean;
  tool_calling_supported: boolean;
}

interface AIModelsResponse {
  models: AIModel[];
}

export function useAIModelsQuery() {
  const { data, error, isLoading } = useSWR<AIModelsResponse>(
    "/api/v1/ai-models",
    publicFetcher,
    {
      revalidateOnFocus: false, // Don't refetch on tab focus (stable data)
      dedupingInterval: 60000, // Cache for 1 minute
    },
  );

  return {
    models: data?.models || [],
    isLoading,
    error,
  };
}
```

Follow patterns from existing hooks like `useResourcesQuery` or similar in the codebase.
Use publicFetcher since this is a public endpoint.
</action>
<verify>

1. Import hook in a test component, verify it returns models array
2. TypeScript compiles without errors
3. Hook properly handles loading and error states
   </verify>
   <done>
   useAIModelsQuery hook fetches and caches AI models data with proper typing
   </done>
   </task>

</tasks>

<verification>
1. API endpoint accessible: `curl http://localhost:3001/api/v1/ai-models | jq '.models | length'`
2. Hook works in React component with proper types
3. Provider icons render for: anthropic, openai, google, meta, mistral
4. TypeScript: `cd apps/x402-jobs && npx tsc --noEmit`
5. Lint: `cd apps/x402-jobs && npm run lint`
</verification>

<success_criteria>

- GET /api/v1/ai-models returns array of AI models with all required fields
- useAIModelsQuery hook provides typed models data
- ProviderIcon component renders icons for 8+ providers with fallback
- No TypeScript or lint errors
  </success_criteria>

<output>
After completion, create `.planning/phases/14-model-browser-ui/14-01-SUMMARY.md`
</output>
