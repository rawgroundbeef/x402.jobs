---
phase: 14-model-browser-ui
plan: 02
type: execute
wave: 2
depends_on: [14-01]
files_modified:
  - apps/x402-jobs/src/components/ModelBrowser/ModelBrowser.tsx
  - apps/x402-jobs/src/components/ModelBrowser/ModelCard.tsx
  - apps/x402-jobs/src/components/ModelBrowser/ModelFilters.tsx
  - apps/x402-jobs/src/components/ModelBrowser/Pagination.tsx
  - apps/x402-jobs/src/components/ModelBrowser/index.ts
  - apps/x402-jobs/src/lib/format.ts
autonomous: true

must_haves:
  truths:
    - "User can see curated models by default on Popular tab"
    - "User can switch to All Models tab to see full catalog"
    - "User can search models by name"
    - "User can filter by modality (text/image/video/audio)"
    - "User can filter by provider"
    - "User can filter by price range"
    - "Each model card displays provider, name, description, modality, context length, pricing"
  artifacts:
    - path: "apps/x402-jobs/src/components/ModelBrowser/ModelBrowser.tsx"
      provides: "Main browser component with tabs and filters"
      exports: ["ModelBrowser"]
    - path: "apps/x402-jobs/src/components/ModelBrowser/ModelCard.tsx"
      provides: "Individual model card display"
      exports: ["ModelCard"]
    - path: "apps/x402-jobs/src/components/ModelBrowser/ModelFilters.tsx"
      provides: "Horizontal filter bar"
      exports: ["ModelFilters"]
    - path: "apps/x402-jobs/src/components/ModelBrowser/Pagination.tsx"
      provides: "Classic pagination with page numbers"
      exports: ["Pagination"]
  key_links:
    - from: "apps/x402-jobs/src/components/ModelBrowser/ModelBrowser.tsx"
      to: "useAIModelsQuery"
      via: "SWR hook import"
      pattern: "useAIModelsQuery"
    - from: "apps/x402-jobs/src/components/ModelBrowser/ModelCard.tsx"
      to: "ProviderIcon"
      via: "icon import"
      pattern: "ProviderIcon"
---

<objective>
Create the Model Browser UI component with search, filters, tabs, and pagination.

Purpose: Users can browse and select AI models when creating OpenRouter resources
Output: Complete ModelBrowser component fulfilling all BROW requirements
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-model-browser-ui/14-CONTEXT.md
@.planning/phases/14-model-browser-ui/14-RESEARCH.md
@.planning/phases/14-model-browser-ui/14-01-SUMMARY.md

# Existing patterns

@apps/x402-jobs/src/components/pages/ResourcesListPage/ResourcesListPage.tsx
@apps/x402-jobs/src/components/modals/ResourcesModal.tsx
@packages/ui/src/tabs.tsx
@packages/ui/src/select.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ModelCard and format utilities</name>
  <files>apps/x402-jobs/src/components/ModelBrowser/ModelCard.tsx, apps/x402-jobs/src/lib/format.ts</files>
  <action>
**1. Add format utilities to format.ts:**

```typescript
// Format context length: 128000 -> "128K", 1000000 -> "1M"
export function formatContextLength(tokens: number | null): string {
  if (!tokens) return "N/A";
  if (tokens >= 1000000) return `${(tokens / 1000000).toFixed(0)}M`;
  return `${(tokens / 1000).toFixed(0)}K`;
}

// Format token price for display: "0.0001" -> "$0.10/1M"
export function formatTokenPrice(pricePerToken: string | null): string {
  if (!pricePerToken) return "Free";
  const price = parseFloat(pricePerToken);
  if (price === 0) return "Free";
  // Convert per-token to per-million-tokens
  const perMillion = price * 1000000;
  if (perMillion < 0.01) return "<$0.01";
  if (perMillion < 1) return `$${perMillion.toFixed(2)}`;
  return `$${perMillion.toFixed(2)}`;
}
```

**2. Create ModelCard.tsx:**

Card component displaying a single model. Props:

- `model: AIModel` - model data
- `onSelect?: (model: AIModel) => void` - click handler
- `isSelected?: boolean` - highlight state

Layout (following CONTEXT.md decisions):

- Provider icon + provider name (top row)
- Model display_name (prominent)
- Description truncated to 2 lines (Tailwind line-clamp-2)
- Modality icons row (use lucide: Type for text, Image for image, Video for video, Volume2 for audio)
- Context length badge ("128K context")
- Pricing row: "In: $X/1M | Out: $Y/1M"
- Curated star badge if is_curated (only shown when not on Popular tab)

Styling:

- `p-4 rounded-lg border border-border bg-card hover:bg-accent transition-colors cursor-pointer`
- Click triggers onSelect
- Selected state: `ring-2 ring-primary`

Use ProviderIcon from '../icons/ProviderIcons'
Use lucide-react icons: Type, Image, Video, Volume2, Star
</action>
<verify>

1. Format utilities work: formatContextLength(128000) returns "128K"
2. Format utilities work: formatTokenPrice("0.000001") returns price string
3. ModelCard renders with all fields visible
4. TypeScript compiles without errors
   </verify>
   <done>
   ModelCard displays model info with provider icon, modality icons, pricing, and context length
   </done>
   </task>

<task type="auto">
  <name>Task 2: Create ModelFilters and Pagination components</name>
  <files>apps/x402-jobs/src/components/ModelBrowser/ModelFilters.tsx, apps/x402-jobs/src/components/ModelBrowser/Pagination.tsx</files>
  <action>
**1. Create ModelFilters.tsx:**

Horizontal filter bar with:

- Search input (with Search icon from lucide)
- Modality dropdown: All Types | Text | Image | Video | Audio | Multimodal
- Provider dropdown: All Providers | (dynamic list from models)
- Price range dropdown: All Prices | Free | Budget ($0-1/1M) | Standard ($1-5/1M) | Premium ($5+/1M)
- Active filter count badge with X to clear all (when any filter active)

Props:

```typescript
interface ModelFiltersProps {
  search: string;
  onSearchChange: (value: string) => void;
  modality: string;
  onModalityChange: (value: string) => void;
  provider: string;
  onProviderChange: (value: string) => void;
  priceRange: string | null;
  onPriceRangeChange: (value: string | null) => void;
  providers: string[]; // List of unique providers for dropdown
  onClearFilters: () => void;
}
```

Use @repo/ui components: Input, Select
Use cn() from @repo/ui/utils for conditional classes
Badge shows "{N} active" with X button when filters active

**2. Create Pagination.tsx:**

Classic pagination with page numbers:

- Previous/Next buttons with ChevronLeft/ChevronRight icons
- Page number buttons (show max 7: [1] ... [4] [5] [6] ... [20])
- Current page highlighted
- Disabled state for prev on first page, next on last page

Props:

```typescript
interface PaginationProps {
  currentPage: number; // 0-indexed
  totalPages: number;
  onPageChange: (page: number) => void;
}
```

Follow MUI pagination pattern for page number generation:

- Always show first and last page
- Show ellipsis (...) when there are gaps
- Show current page and 1 page on each side

Use Button from @repo/ui/button
</action>
<verify>

1. ModelFilters renders with all dropdowns
2. Filter changes trigger callbacks
3. Active filter badge shows count and clears correctly
4. Pagination shows correct page numbers and handles clicks
5. TypeScript compiles without errors
   </verify>
   <done>
   ModelFilters provides search + 3 filter dropdowns with clear all; Pagination shows page numbers with ellipsis
   </done>
   </task>

<task type="auto">
  <name>Task 3: Create ModelBrowser main component with state management</name>
  <files>apps/x402-jobs/src/components/ModelBrowser/ModelBrowser.tsx, apps/x402-jobs/src/components/ModelBrowser/index.ts</files>
  <action>
**1. Create ModelBrowser.tsx:**

Main browser component that:

- Uses useAIModelsQuery() to fetch models
- Manages tab state: "popular" | "all" (default "popular")
- Manages filter state: search, modality, provider, priceRange
- Manages pagination state: currentPage (reset on filter/tab change)
- Applies client-side filtering with useMemo
- Renders grid of ModelCard components

Props:

```typescript
interface ModelBrowserProps {
  onSelect?: (model: AIModel) => void;
  selectedModelId?: string;
}
```

State management:

- `activeTab`: "popular" | "all" - default "popular"
- `search`: string - debounced with 300ms
- `modality`: string - "all" | "text" | "image" | "video" | "audio" | "multimodal"
- `provider`: string - "all" | specific provider name
- `priceRange`: string | null - null | "free" | "budget" | "standard" | "premium"
- `currentPage`: number - reset to 0 when any filter changes

Filtering logic (useMemo):

1. If activeTab === "popular", filter to is_curated === true
2. If search, filter display_name.toLowerCase().includes(search)
3. If modality !== "all", filter by modality
4. If provider !== "all", filter by provider
5. If priceRange, filter by pricing_completion range

Pagination:

- ITEMS_PER_PAGE = 20
- Slice filtered results based on currentPage
- Only show pagination on "all" tab when > 20 results

Layout:

```
[Tabs: Popular | All Models]
[ModelFilters: Search | Modality | Provider | Price | Clear]
[Grid: 1/2/3/4 columns responsive]
[Pagination: only on All tab when needed]
[Empty state when no results]
[Loading spinner when loading]
```

Grid classes: `grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4`

Empty state: Show Box icon + "No models match your filters" + Clear filters button

Loading state: Centered spinner (follow ResourcesListPage pattern)

**2. Create index.ts:**

```typescript
export { ModelBrowser } from "./ModelBrowser";
export { ModelCard } from "./ModelCard";
export type { AIModel } from "@/hooks/useAIModelsQuery";
```

  </action>
  <verify>
1. ModelBrowser renders with Popular tab active by default
2. Search filters models in real-time (debounced)
3. Modality/Provider/Price filters work correctly
4. Tab switch changes between curated and all models
5. Pagination appears on All tab with many results
6. Empty state shows when no matches
7. Loading state shows while fetching
8. TypeScript compiles without errors
9. Lint passes: `npm run lint`
  </verify>
  <done>
ModelBrowser component provides complete browsing experience with tabs, search, filters, pagination, and model selection
  </done>
</task>

</tasks>

<verification>
**Functional tests:**
1. Load browser - Popular tab shows ~20-30 curated models
2. Switch to All Models - shows 200+ models with pagination
3. Search "claude" - filters to Anthropic Claude models
4. Select Modality: Image - shows only image models
5. Select Provider: OpenAI - shows only OpenAI models
6. Select Price: Free - shows only free models
7. Clear filters - resets all filters
8. Click model card - triggers onSelect callback
9. Page navigation works on All tab

**Build tests:**

- `cd apps/x402-jobs && npm run build` - no errors
- `cd apps/x402-jobs && npm run lint` - no warnings
- TypeScript: `npx tsc --noEmit` - no errors
  </verification>

<success_criteria>

- BROW-01: Default view shows curated popular models (Popular tab with is_curated filter)
- BROW-02: "Show all models" toggle reveals full catalog (All Models tab)
- BROW-03: Search models by name (debounced search filter)
- BROW-04: Filter by modality (modality dropdown)
- BROW-05: Filter by provider (provider dropdown)
- BROW-06: Filter by price range (price range dropdown)
- BROW-07: Display per-model: pricing, capabilities, context length (ModelCard)
- Components integrate cleanly with no TypeScript or lint errors
  </success_criteria>

<output>
After completion, create `.planning/phases/14-model-browser-ui/14-02-SUMMARY.md`
</output>
